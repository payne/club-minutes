<div class="minutes-app">
  <mat-toolbar color="primary" class="no-print">
    <button mat-icon-button [matMenuTriggerFor]="menu">
      <mat-icon>menu</mat-icon>
    </button>
    <span class="toolbar-title">
      <span *ngIf="currentClub && currentFile && minutes">
        {{ currentClub.name }} - {{ currentFile.type === 'board' ? 'Board' : 'Meeting' }} - {{ minutes.date | date:'mediumDate' }}
      </span>
      <span *ngIf="!currentClub || !currentFile || !minutes">
        {{ currentClub?.name || 'Club Minutes' }}
      </span>
    </span>
    <span class="spacer"></span>
    <button mat-icon-button color="accent" (click)="print()" *ngIf="!loading && !error" class="mobile-only">
      <mat-icon>print</mat-icon>
    </button>
    <button mat-raised-button color="accent" (click)="print()" *ngIf="!loading && !error" class="desktop-only">
      <mat-icon>print</mat-icon>
      Print
    </button>
  </mat-toolbar>

  <mat-menu #menu="matMenu">
    <button mat-menu-item [matMenuTriggerFor]="clubMenu" *ngIf="clubs.length > 1">
      <mat-icon>group</mat-icon>
      <span>Select Club</span>
    </button>
    <mat-divider *ngIf="clubs.length > 1"></mat-divider>
    <button mat-menu-item [matMenuTriggerFor]="minutesTypeMenu">
      <mat-icon>category</mat-icon>
      <span>Minutes Type</span>
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item [matMenuTriggerFor]="minutesMenu">
      <mat-icon>folder</mat-icon>
      <span>Select Minutes</span>
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="toggleDarkMode()">
      <mat-icon>{{ darkMode ? 'light_mode' : 'dark_mode' }}</mat-icon>
      <span>{{ darkMode ? 'Light Mode' : 'Dark Mode' }}</span>
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="openAboutDialog()">
      <mat-icon>info</mat-icon>
      <span>About</span>
    </button>
  </mat-menu>

  <mat-menu #clubMenu="matMenu">
    <button mat-menu-item *ngFor="let club of clubs" (click)="selectClub(club)">
      <mat-icon>{{ currentClub?.id === club.id ? 'check' : '' }}</mat-icon>
      <span>{{ club.name }}</span>
    </button>
  </mat-menu>

  <mat-menu #minutesTypeMenu="matMenu">
    <button mat-menu-item (click)="selectMinutesType('board')">
      <mat-icon>{{ selectedMinutesType === 'board' ? 'check' : '' }}</mat-icon>
      <span>Board Minutes</span>
    </button>
    <button mat-menu-item (click)="selectMinutesType('meeting')">
      <mat-icon>{{ selectedMinutesType === 'meeting' ? 'check' : '' }}</mat-icon>
      <span>General Meetings</span>
    </button>
  </mat-menu>

  <mat-menu #minutesMenu="matMenu">
    <button mat-menu-item *ngFor="let file of filteredMinutes" (click)="loadMinutesFile(file)">
      <mat-icon>{{ currentFile?.url === file.url ? 'check' : '' }}</mat-icon>
      <span>{{ file.title }}</span>
    </button>
  </mat-menu>

  <div class="container">
    <div *ngIf="loading" class="loading">Loading minutes...</div>
    <div *ngIf="error" class="error">Error loading minutes. Please check the data file.</div>

    <div *ngIf="!loading && !error && minutes" class="minutes-content">
      <div class="header print-only">
        <h1>{{ minutes.clubName }}</h1>
        <h2>{{ currentFile?.type === 'board' ? 'Board Meeting Minutes' : 'General Meeting Minutes' }}</h2>
        <p class="date">{{ minutes.date | date:'fullDate' }}</p>
      </div>

      <mat-accordion>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Attendance</mat-panel-title>
          </mat-expansion-panel-header>
          <app-attendance [attendees]="minutes.attendees"></app-attendance>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Financial Report</mat-panel-title>
          </mat-expansion-panel-header>
          <app-financial-report [financialData]="minutes.financialReport"></app-financial-report>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Minutes Approval</mat-panel-title>
          </mat-expansion-panel-header>
          <app-minutes-approval [approval]="minutes.minutesApproval"></app-minutes-approval>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>President's Report</mat-panel-title>
          </mat-expansion-panel-header>
          <app-president-report [report]="minutes.presidentReport"></app-president-report>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Vice President's Report</mat-panel-title>
          </mat-expansion-panel-header>
          <app-vice-president-report [report]="minutes.vicePresidentReport"></app-vice-president-report>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Committee Reports</mat-panel-title>
          </mat-expansion-panel-header>
          <app-committee-reports [reports]="minutes.committeeReports"></app-committee-reports>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Old Business</mat-panel-title>
          </mat-expansion-panel-header>
          <app-old-business [items]="minutes.oldBusiness"></app-old-business>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>New Business</mat-panel-title>
          </mat-expansion-panel-header>
          <app-new-business [items]="minutes.newBusiness"></app-new-business>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Announcements</mat-panel-title>
          </mat-expansion-panel-header>
          <app-announcements [items]="minutes.announcements"></app-announcements>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div>
